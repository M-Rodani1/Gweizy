[phases.setup]
nixPkgs = ["python311", "gcc", "gccStdenv"]

[phases.install]
cmds = [
  "echo '=== Finding libgomp ==='",
  "find /nix/store -name 'libgomp.so*' 2>/dev/null | head -10",
  "export LIBGOMP_PATH=$(dirname $(find /nix/store -name 'libgomp.so.1' 2>/dev/null | head -1))",
  "echo 'LIBGOMP_PATH='$LIBGOMP_PATH",
  "echo $LIBGOMP_PATH > /tmp/libgomp_path.txt",
  "rm -rf .venv",
  "python -m venv .venv",
  ".venv/bin/pip install --no-cache-dir --upgrade pip",
  ".venv/bin/pip install --no-cache-dir -r backend/requirements.txt",
]

[variables]
LD_LIBRARY_PATH = "/nix/store"
